{% extends "base.html"%}  {% include "navbar.html"%}


{% block content %}
<link href="{{ url_for('static', filename='details.css') }}" rel="stylesheet">

<div id="container">
    <h1> Demmande Reservation</h1></div>
{% endblock %}
{% block details %}
<div id="container_1" class="col-12">
    <form id="form" name="form" class="row g-3 " novalidate action="" method="post">
        <input type="hidden" readonly class="form-control" name="reservation_request_id" value="{{request_id}}">

        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Nom</label>
            <input type="text" readonly class="form-control" value="{{last_name}}">
        </div>
        <br>
        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Prenom</label>
            <input type="text" readonly class="form-control" value="{{first_name}}">
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Type identification </label>
            <input type="text" readonly class="form-control" value="{{type_id}}">
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Numero identification </label>
            <input type="text" readonly class="form-control" value="{{num_id}}">
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label for="validation" class="form-label"
                   style="">Code dotation</label>
            <input type="text" class="form-control" id="validation"
                   value="{{dotation_code}}" readonly>
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label for="validationCusto" class="form-label"
                   style="">Libelle dotation</label>
            <input type="text" class="form-control" style="" id="validationCusto"
                   value="{{dotation_libelle}}" readonly>
        </div>

        <div class="mb-3 form-check" id="oc_solde" style="width: 50%;display:none;">
            <label class="form-label">Nouveau Solde OC</label><span style="color: #af5151;">*</span>
            <input type="number" step="0.01" required onchange="" oninput="changeHandler(this)" id="inp_solde" class="form-control"
                   name="oc_new_solde">
                        <span id="span_solde" class="form-control is-invalid"
                  style="display:none;color: #e93737;border: solid;text-align: center;margin-top: 2%;">solde limite 100000 </span>

        </div>
        <div class="mb-3 form-check" id="ticket_num" style="width: 50%;display:none;">
            <label class="form-label">Numero Ticket OC  </label><span style="color: #af5151;">*</span>
            <input type="hidden" required class="form-control" maxlength="20" onchange="" oninput="ticketHandler(this)"
                   id="inp_ticket"
                   name="oc_ticket_num">
            <span id="span_ticket" class="form-control is-invalid"
                  style="display:none;color: #e93737;border: solid;text-align: center;margin-top: 2%;">veuillez inserer un numero ticket valide </span>

        </div>

        <span id="spn"
              style="display:none;color: #e93737;width: 23%;margin-left: 39%;border-color: black;border: solid;">veuillez remplir les champs * requis </span>
        <button type="submit" class="btn btn-success" style="display:none;width: 14%;margin-left: 44%;" id="valider">
            valider
        </button>

    </form>

</div>

{% endblock %}

{% block button %}
<div class="container"
     style="margin-left: 2%;padding: 1%;margin-right: -22%;display: flex;flex-direction: row;align-content: stretch;flex-wrap: nowrap;justify-content: center;">

    <!--    <a href="">-->
    <button id="force" value="{{request_id}}" class="btn btn-primary" type="submit"
            style="width: 17%;height: 11%;margin-left: 5%;">réserver
    </button>
    <!--    </a>-->
    <!--    <a href="">-->
    <button class="btn btn-danger" id="solde_ind" style="width: 17%;height: 11%; margin-left: 2px;">annuler
        réservation
    </button>
    <!--    </a>-->
    <a href="{{ url_for('back_office.listreservation',)}}">
        <button class="btn btn-warning" style="width: 109%;height: 101%;margin-left: 2px;">Retour</button>
    </a>

</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
$(document).ready(function() {
    $("#force").click(function() {

        $('#span_ticket').css({
            'display': 'none'
        });
        $('#span_solde').css({
            'display': 'none'
        });

        $("#inp_ticket").css({
            'border-color': ''
        });
        $("#inp_solde").css({
            'border-color': ''
        });

        $("#inp_ticket").val("");
        $("#inp_solde").val("");

        $('#spn').css({
            'display': 'none'
        });
        if ($("#ticket_num").is(":visible") && $("#oc_solde").is(":visible")) {

            $('#inp_ticket').attr('type', 'hidden');
            $("#ticket_num").slideToggle("slow", "linear");
            $("#oc_solde").slideToggle("slow", "linear");
            $("#valider").slideToggle("slow", );
        } else if ($("#oc_solde").is(":visible")) {
            $('#inp_ticket').attr('type', 'text');
            $("#ticket_num").slideToggle("slow", );
            $('#form').attr('action', '{{ url_for("back_office.force_reservation")}}');

        } else {
            $('#inp_ticket').attr('type', 'text');
            $("#ticket_num").slideToggle("slow", "linear");
            $("#oc_solde").slideToggle("slow", "linear");
            $('#form').attr('action', '{{ url_for("back_office.force_reservation")}}');
            $("#valider").slideToggle("slow", );
        }
        ;
    });
})
$(document).ready(function() {
    $("#solde_ind").click(function() {
        $('#span_solde').css({
            'display': 'none'
        });

        $("#inp_ticket").css({
            'border-color': ''
        });
        $("#inp_solde").css({
            'border-color': ''
        });

        $("#inp_ticket").val("");
        $("#inp_solde").val("");
        $('#span_ticket').css({
            'display': 'none'
        });
        $('#spn').css({
            'display': 'none'
        });
        if ($("#ticket_num").is(":visible")) {
            $('#inp_ticket').attr('type', 'hidden');
            $("#ticket_num").slideToggle("slow", );
            $('#form').attr('action', '{{ url_for("back_office.cancel_reservation")}}');
        } else {
            $("#oc_solde").slideToggle("slow", "linear");
            $('#form').attr('action', '{{ url_for("back_office.cancel_reservation")}}');
            $("#valider").slideToggle("slow", );
        }
        ;
    });
})

$(document).ready(function() {
    $("#valider").click(function() {
    
        if ($('#inp_ticket').is(':empty')){
        $('#span_ticket').css('display','none')
        }
        
        if ($('#inp_ticket').is(':empty')){
        $('#span_ticket').css('display','none')
        }

        if ($('#ticket_num').css({
            'border-color': '#e68585'
        })) {
            $('#ticket_num').css({
                'border-color': 'green'
            });
        }
        ;

    });
})

$("form").on("submit", function() {

    var has_empty = false;

    $(this).find('input[type!="hidden"]').each(function() {

        if (!$(this).val()) {
            has_empty = true;

            $(this).css({
                'border-color': '#e68585'
            });
            $(this).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);

        }

    });

    if (has_empty) {
        return false;
    }
    var ticket = $('#inp_ticket').val();
    console.log(ticket)
    if ($("#ticket_num").is(":visible")) {
        if (!ticket.match(/^[A-Z0-9]+$/)) {
            $('#span_ticket').css({
                'display': 'block'
            });

            return false;
        }
    }

});

function changeHandler(val) {
    if (Number(val.value) > 100000) {
        val.value = 100000
        $('#span_solde').css({
            'display': 'block'
        });
    }
    else if (val.value.length == 0) {
     $('#span_solde').css({
            'display': 'none'
        });
    }else if (val.value.length > 0) {
     $('#inp_solde').css({
            'border-color': ''
        });
    }
}

function ticketHandler(val) {
    if (val.value.length == 0) {

        $('#span_ticket').css({
            'display': 'none'
        });
    }else if (val.value.length > 0) {
     $('#inp_ticket').css({
            'border-color': ''
        });
    }
}


</script>

{% endblock %}


{% extends "base.html"%} {% block title %}RÃ©servation{% endblock %}

{% block nav %}{% include "navbar.html"%} {% endblock %}
{% block content %}
<link href="{{ url_for('static', filename='details.css') }}" rel="stylesheet">

<div id="container">
    <h1 id="title">Demmande Reservation </h1></div>
{% endblock %}
{% block details %}
<div id="container_1" class="col-12">
    <form id="form" name="form" class="row g-3 " novalidate action="" method="post" autocomplete="off">
        <input type="hidden" readonly class="form-control" name="reservation_request_id" value="{{request_id}}">

        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Nom</label>
            <input type="text" readonly class="form-control" value="{{last_name}}">
        </div>
        <br>
        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Prenom</label>
            <input type="text" readonly class="form-control" value="{{first_name}}">
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Type identification </label>
            <input type="text" readonly class="form-control" value="{{type_id}}">
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label class="form-label">Numero identification </label>
            <input type="text" readonly class="form-control" value="{{num_id}}">
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label for="dotation_code" class="form-label"
                   style="">Code dotation</label>
            <input type="text" class="form-control" id="dotation_code"
                   value="{{dotation_code}}" readonly>
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label for="validationCusto" class="form-label"
                   style="">Libelle dotation</label>
            <input type="text" class="form-control" style="" id="validationCusto"
                   value="{{dotation_libelle}}" readonly>
        </div>
        <div class="mb-3 form-check" style="width: 50%;">
            <label for="validationCusto" class="form-label"
                   style="">Montant</label>
            <input type="text" class="form-control" style="" id="validationC"
                   value="{{montant}}" readonly>
        </div>
        <b></b>
        <div class="mb-3 form-check" style="width: 20%;margin-left: 35%;">
            <a id="force"><input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1"
                                 name="force"></a>
            <label class="form-check-label" for="flexRadioDefault1">
                Solde suffisant
            </label>
        </div>
        <div class="mb-3 form-check" style="width:30%">
            <a id="solde_ind"><input class="form-check-input" type="radio" name="flexRadioDefault"
                                     id="flexRadioDefault2"></a>
            <label class="form-check-label" for="flexRadioDefault2">
                Solde insuffisant
            </label>
        </div>

        <div class="mb-3 form-check" id="oc_solde" style="width: 50%;display:none;">
            <label class="form-label">Nouveau Solde OC</label><span style="color: #af5151;">*</span>
            <input type="number" step="0.01" required onchange="" oninput="changeHandler(this)" id="inp_solde"
                   class="form-control"
                   name="oc_new_solde">
            <span id="span_solde" class="form-control is-invalid"
                  style="display:none;color: #e93737;border: solid;text-align: center;margin-top: 2%;"> </span>

        </div>
        <div class="mb-3 form-check" id="ticket_num" style="width: 50%;display:none;">
            <label class="form-label">Numero Ticket OC </label><span style="color: #af5151;">*</span>
            <input type="hidden" required class="form-control" maxlength="20" oninput="ticketHandler(this)"
                   id="inp_ticket"
                   name="oc_ticket_num">
            <span id="span_ticket" class="form-control is-invalid"
                  style="display:none;color: #e93737;border: solid;text-align: center;margin-top: 2%;">veuillez inserer un numero ticket valide </span>

        </div>

        <span id="spn"
              style="display:none;color: #e93737;width: 23%;margin-left: 39%;border-color: black;border: solid;">veuillez remplir les champs * requis </span>
        <button type="submit" class="btn btn"
                style="display:none;width: 14%;margin-left: 43%;background-color: #1ab394;color:white;" id="valider">
            Valider
        </button>


    </form>


</div>

        <button id="retour" type="submit" class="btn btn-warning" style="width: 14%;margin-left: 0%;margin-top: 2%;color: white;">Retour</button>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
$(document).ready(function() {
    $("#force").click(function() {

        $('#span_ticket').css({
            'display': 'none'
        });
        $('#span_solde').css({
            'display': 'none'
        });

        $("#inp_ticket").css({
            'border-color': ''
        });
        $("#inp_solde").css({
            'border-color': ''
        });

        $("#inp_ticket").val("");
        $("#inp_solde").val("");

        $('#spn').css({
            'display': 'none'
        });
        if ($("#ticket_num").is(":visible") && $("#oc_solde").is(":visible")) {

            $('#inp_ticket').attr('type', 'hidden');
            $("#ticket_num").slideToggle("slow", "linear");
            $("#oc_solde").slideToggle("slow", "linear");
            $("#valider").slideToggle("slow", );
        } else if ($("#oc_solde").is(":visible")) {
            $('#inp_ticket').attr('type', 'text');
            $("#ticket_num").slideToggle("slow", );
            $('#form').attr('action', '{{ url_for("back_office.force_reservation")}}');

        } else {
            $('#inp_ticket').attr('type', 'text');
            $("#ticket_num").slideToggle("slow", "linear");
            $("#oc_solde").slideToggle("slow", "linear");
            $('#form').attr('action', '{{ url_for("back_office.force_reservation")}}');
            $("#valider").slideToggle("slow", );
        }
        ;
    });
})
$(document).ready(function() {
    $("#solde_ind").click(function() {

        $('#span_solde').css({
            'display': 'none'
        });

        $("#inp_ticket").css({
            'border-color': ''
        });
        $("#inp_solde").css({
            'border-color': ''
        });

        $("#inp_ticket").val("");
        $("#inp_solde").val("");
        $('#span_ticket').css({
            'display': 'none'
        });
        $('#spn').css({
            'display': 'none'
        });
        if ($("#ticket_num").is(":visible")) {
            $('#inp_ticket').attr('type', 'hidden');
            $("#ticket_num").slideToggle("slow", );
            $('#form').attr('action', '{{ url_for("back_office.cancel_reservation")}}');
        } else {
            $("#oc_solde").slideToggle("slow", "linear");
            $('#form').attr('action', '{{ url_for("back_office.cancel_reservation")}}');
            $("#valider").slideToggle("slow", );
        }
        ;
    });
})

$(document).ready(function() {
    $("#valider").click(function() {

        if ($('#inp_ticket').is(':empty')){
        $('#span_ticket').css('display','none')
        }

        if ($('#inp_ticket').is(':empty')){
        $('#span_ticket').css('display','none')
        }

        if ($('#ticket_num').css({
            'border-color': '#e68585'
        })) {
            $('#ticket_num').css({
                'border-color': 'green'
            });
        }
        ;

    });
})

$("form").on("submit", function() {

    var has_empty = false;

    $(this).find('input[type!="hidden"]').each(function() {

        if (!$(this).val()) {
            has_empty = true;

            $(this).css({
                'border-color': '#e68585'
            });
            $(this).fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200);

        }

    });

    if (has_empty) {
        return false;
    }
    var ticket = $('#inp_ticket').val();
    console.log(ticket)
    if ($("#ticket_num").is(":visible")) {
        if (!ticket.match(/^[A-Z0-9]+$/)) {
            $('#span_ticket').css({
                'display': 'block'
            });

            return false;
        }
    }

});

function changeHandler(val) {
    if ($('#dotation_code').val() == '1250'){
         if (Number(val.value) > 10000) {
            val.value = 10000;
            $('#span_solde').css({
            'display': 'block'
            });
            $('#span_solde').text('Solde limite 10000');
        }if (Number(val.value) < 10000) {
                $('#span_solde').css({
                'display': 'none'
                });
        }
    }if ($('#dotation_code').val() == '1820'){
         if (Number(val.value) > 15000) {
            val.value = 15000
            $('#span_solde').css({
            'display': 'block'
            });
            $('#span_solde').text('Solde limite 15000');
        }if (Number(val.value) < 15000) {
                $('#span_solde').css({
                'display': 'none'
                });
        }
    } else if ($('#dotation_code').val() == '302' || $('#dotation_code').val() == '301' || $('#dotation_code').val() == '303' ){
        if (Number(val.value) > 100000) {
        val.value = 100000
        $('#span_solde').css({
            'display': 'block'
        });
        $('#span_solde').text('Solde limite 100000');
        } if (Number(val.value) < 100000) {
                $('#span_solde').css({
                'display': 'none'
                });
        }
     } if (val.value.length == 0) {
        $('#span_solde').css({
            'display': 'none'
        });
         $('#inp_solde').css({
            'border-color': ''
        });
    }else if (val.value.length > 0) {

         $('#inp_solde').css({
            'border-color': ''
        });
    }
}

function ticketHandler(val) {
    if (val.value.length == 0) {

        $('#span_ticket').css({
            'display': 'none'
        });
    }else if (val.value.length > 0) {
     $('#inp_ticket').css({
            'border-color': ''
        });
    }
     var ticket = $('#inp_ticket').val();
    if ($("#ticket_num").is(":visible")) {
        if ($('#inp_ticket').val().length < 1) {
            $('#inp_ticket').css({
            'border-color': ''
         });
        $('#span_ticket').css({
                'display': 'none'
            });
        }
        else if (!ticket.match(/^[A-Z0-9]+$/)) {
            $('#span_ticket').css({
                'display': 'block'
            });
             $('#inp_ticket').css({
            'border-color': '#e68585'
            });

            return false;
        }else  if (ticket.match(/^[A-Z0-9]+$/)) {
            $('#span_ticket').css({
                'display': 'none'
            });
            $('#inp_ticket').css({
            'border-color': ''
            });

            return false;
      }
    }
}

$(document).ready(function() {
    $("#retour").click(function() {
        window.location = "{{ url_for('back_office.listreservation')}}"
});
})


</script>


{% endblock %}

